<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Status Monitor</title>

    <!-- Bootstrap CSS (CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .market-card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        .market-status {
            font-weight: bold;
        }
        .text-muted {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2><i class="fas fa-clock"></i> Market Status Monitor</h2>
        <p class="text-muted">All times in Jerusalem (Updated every second)</p>
        <h5 id="current-time"></h5>
    </div>

    <div class="row justify-content-center">
        <!-- NYSE Market Card -->
        <div class="col-md-6">
            <div class="card market-card p-3 mb-4">
                <h4 class="mb-3"><i class="fas fa-building"></i> NYSE</h4>
                <p class="market-status"><span id="nyse-status"></span></p>
                <p class="text-muted"><span id="nyse-message"></span></p>
                <p class="text-muted"><span id="nyse-absolute"></span></p>
            </div>
        </div>

        <!-- TASE Market Card -->
        <div class="col-md-6">
            <div class="card market-card p-3 mb-4">
                <h4 class="mb-3"><i class="fas fa-landmark"></i> TASE</h4>
                <p class="market-status"><span id="tase-status"></span></p>
                <p class="text-muted"><span id="tase-message"></span></p>
                <p class="text-muted"><span id="tase-absolute"></span></p>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const LOCALE_TIME_SETTINGS = { timeZone: "Asia/Jerusalem", minute: "2-digit", hour: "2-digit", hour12: false };

    // NYSE & TASE Holidays (2025-2030)
    const nyseHolidays = {
        "2025-01-01": "New Year's Day",
        "2025-01-20": "Martin Luther King Jr. Day",
        "2025-02-17": "Presidents' Day",
        "2025-04-18": "Good Friday",
        "2025-05-26": "Memorial Day",
        "2025-06-19": "Juneteenth National Independence Day",
        "2025-07-04": "Independence Day",
        "2025-09-01": "Labor Day",
        "2025-11-27": "Thanksgiving Day",
        "2025-12-25": "Christmas Day",
        // Add more holidays until 2030
    };

    const taseHolidays = {
        "2025-03-14": "Purim",
        "2025-04-13": "Passover",
        "2025-04-14": "Passover",
        "2025-04-20": "Passover",
        "2025-05-14": "Independence Day",
        "2025-06-02": "Shavuot",
        "2025-07-27": "Tisha B'Av",
        "2025-09-24": "Yom Kippur",
        "2025-09-25": "Yom Kippur",
        "2025-09-26": "Sukkot",
        // Add more holidays until 2030
    };

    function updateMarketStatus() {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleTimeString("en-US", { timeZone: "Asia/Jerusalem" });

        // NYSE Market Status
        const nyseOpen = isMarketOpen(now, "NYSE");
        document.getElementById('nyse-status').innerHTML = getStatusHTML(nyseOpen);
        const { message, absoluteTime } = getMarketMessage(now, "NYSE");
        document.getElementById('nyse-message').textContent = message;
        document.getElementById('nyse-absolute').textContent = absoluteTime;

        // TASE Market Status
        const taseOpen = isMarketOpen(now, "TASE");
        document.getElementById('tase-status').innerHTML = getStatusHTML(taseOpen);
        const { message: taseMessage, absoluteTime: taseAbsoluteTime } = getMarketMessage(now, "TASE");
        document.getElementById('tase-message').textContent = taseMessage;
        document.getElementById('tase-absolute').textContent = taseAbsoluteTime;

        // Display holiday message if today is a holiday
        const dateString = now.toISOString().split('T')[0];
        if (nyseHolidays[dateString]) {
            document.getElementById('nyse-message').textContent = `Closed for ${nyseHolidays[dateString]}`;
        }
        if (taseHolidays[dateString]) {
            document.getElementById('tase-message').textContent = `Closed for ${taseHolidays[dateString]}`;
        }
    }

    function isMarketOpen(date, market) {
        const day = date.getDay();
        const hours = date.getUTCHours();
        const minutes = date.getUTCMinutes();
        const currentTime = hours * 60 + minutes;
        const dateString = date.toISOString().split('T')[0];

        if (market === "NYSE") {
            if (nyseHolidays[dateString] || day === 0 || day === 6) return false;
            return currentTime >= 870 && currentTime < 1260; // 14:30 - 21:00 UTC (9:30 AM - 4:00 PM NY time)
        } else if (market === "TASE") {
            if (taseHolidays[dateString] || day === 5 || day === 6) return false;
            return currentTime >= 420 && currentTime < 925; // 7:00 - 15:25 UTC (9:00 AM - 5:25 PM Israel time)
        }
        return false;
    }

    function getStatusHTML(isOpen) {
        return `<span class="status-indicator ${isOpen ? 'bg-success' : 'bg-danger'}"></span> ${isOpen ? 'Open' : 'Closed'}`;
    }

    function getMarketMessage(date, market) {
        const openingTime = market === "NYSE" ? 870 : 420;
        const closingTime = market === "NYSE" ? 1260 : 925;
        let nextOpen = new Date(date);
        nextOpen.setUTCHours(Math.floor(openingTime / 60), openingTime % 60, 0, 0);

        if (date.getUTCHours() * 60 + date.getUTCMinutes() >= closingTime) {
            nextOpen.setDate(nextOpen.getDate() + 1);
        }
        
        while (!isMarketOpen(nextOpen, market)) {
            nextOpen.setDate(nextOpen.getDate() + 1);
        }

        const timeUntilOpen = (nextOpen - date) / (1000 * 60);
        const absoluteTime = `Opens at ${convertToJerusalemTime(nextOpen).toLocaleTimeString("en-US", LOCALE_TIME_SETTINGS)} on ${convertToJerusalemTime(nextOpen).toLocaleDateString("en-US", { timeZone: "Asia/Jerusalem", dateStyle: "short" })}`;
        const message = `Opens in ${Math.floor(timeUntilOpen / 60)}h ${Math.floor(timeUntilOpen % 60)}m`;

        return { message, absoluteTime };
    }

    function convertToJerusalemTime(date) {
        return new Date(date.toLocaleString("en-US", { timeZone: "Asia/Jerusalem" }));
    }

    setInterval(updateMarketStatus, 1000);
    updateMarketStatus();
</script>

</body>
</html>

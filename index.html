<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Status Monitor</title>

    <!-- Bootstrap CSS (CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .market-card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        .market-status {
            font-weight: bold;
        }
        .text-muted {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2><i class="fas fa-clock"></i> Market Status Monitor</h2>
        <p class="text-muted">All times in Jerusalem (Updated every second)</p>
        <h5 id="current-time"></h5>
    </div>

    <div class="row justify-content-center">
        <!-- NYSE Market Card -->
        <div class="col-md-6">
            <div class="card market-card p-3 mb-4">
                <h4 class="mb-3"><i class="fas fa-building"></i> NYSE</h4>
                <p class="market-status"><span id="nyse-status"></span></p>
                <p class="text-muted"><span id="nyse-message"></span></p>
                <p class="text-muted"><span id="nyse-absolute"></span></p>
            </div>
        </div>

        <!-- TASE Market Card -->
        <div class="col-md-6">
            <div class="card market-card p-3 mb-4">
                <h4 class="mb-3"><i class="fas fa-landmark"></i> TASE</h4>
                <p class="market-status"><span id="tase-status"></span></p>
                <p class="text-muted"><span id="tase-message"></span></p>
                <p class="text-muted"><span id="tase-absolute"></span></p>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // NYSE & TASE Holidays (2025-2030)
    const nyseHolidays = ["2025-01-01", "2025-01-20", "2025-02-17", "2025-04-18", "2025-05-26", "2025-06-19", "2025-07-04", "2025-09-01", "2025-11-27", "2025-12-25"];
    const taseHolidays = ["2025-03-14", "2025-04-13", "2025-04-14", "2025-04-20", "2025-05-14", "2025-06-02", "2025-07-27", "2025-09-24", "2025-09-25", "2025-09-26"];

    function updateMarketStatus() {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleTimeString("en-US", { timeZone: "Asia/Jerusalem" });

        // NYSE Market Status
        const nyseOpen = isMarketOpen(now, "NYSE");
        document.getElementById('nyse-status').innerHTML = getStatusHTML(nyseOpen);
        const { message, absoluteTime } = getMarketMessage(now, "NYSE");
        document.getElementById('nyse-message').textContent = message;
        document.getElementById('nyse-absolute').textContent = absoluteTime;

        // TASE Market Status
        const taseOpen = isMarketOpen(now, "TASE");
        document.getElementById('tase-status').innerHTML = getStatusHTML(taseOpen);
        const { message: taseMessage, absoluteTime: taseAbsoluteTime } = getMarketMessage(now, "TASE");
        document.getElementById('tase-message').textContent = taseMessage;
        document.getElementById('tase-absolute').textContent = taseAbsoluteTime;
    }

    function isMarketOpen(date, market) {
        const day = date.getDay();
        const hours = date.getHours();
        const minutes = date.getMinutes();
        const currentTime = hours * 60 + minutes;
        const dateString = date.toISOString().split('T')[0];

        if (market === "NYSE") {
            if (nyseHolidays.includes(dateString) || day === 0 || day === 6) return false;
            return currentTime >= 570 && currentTime < 960;
        } else if (market === "TASE") {
            if (taseHolidays.includes(dateString) || day === 5 || day === 6) return false;
            return currentTime >= 540 && currentTime < 990;
        }
        return false;
    }

    function getStatusHTML(isOpen) {
        return `<span class="status-indicator ${isOpen ? 'bg-success' : 'bg-danger'}"></span> ${isOpen ? 'Open' : 'Closed'}`;
    }

    function getMarketMessage(date, market) {
        const openingTime = market === "NYSE" ? 570 : 540;
        const closingTime = market === "NYSE" ? 960 : 990;
        let nextOpen = new Date(date);
        nextOpen.setHours(Math.floor(openingTime / 60), openingTime % 60, 0, 0);
        
        while (!isMarketOpen(nextOpen, market)) {
            nextOpen.setDate(nextOpen.getDate() + 1);
        }

        const timeUntilOpen = (nextOpen - date) / (1000 * 60);
        const absoluteTime = `Opens at ${nextOpen.toLocaleTimeString("en-US", { timeZone: "Asia/Jerusalem" })} on ${nextOpen.toLocaleDateString("en-US", { timeZone: "Asia/Jerusalem" })}`;
        const message = `Opens in ${Math.floor(timeUntilOpen / 60)}h ${Math.floor(timeUntilOpen % 60)}m`;

        return { message, absoluteTime };
    }

    setInterval(updateMarketStatus, 1000);
    updateMarketStatus();
</script>

</body>
</html>
